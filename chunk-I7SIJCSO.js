import{b as pe}from"./chunk-LPWK7B5U.js";import{Aa as le,Ba as C,Da as m,Ea as c,Fa as q,Ga as ue,Ja as M,Ka as R,O as ae,Q as B,U as _,V as g,bb as z,cb as w,ka as f,na as y,qa as b,ra as V,ta as ce,ua as de,va as O,wa as I,xa as k,ya as p,za as d}from"./chunk-HFRUW2FE.js";import"./chunk-2XJVAMHT.js";var U=class e{get occupancy(){return new a(this.normie_pieces_bitboard.getBoard()|this.golden_pieces_bitboard.getBoard())}get normie_pieces(){return this._normie_pieces}get golden_pieces(){return this._golden_pieces}get golden_squares(){return this._golden_squares}constructor(t,o,r){this._listOfMoves=[],this._undoList=[],this._currentLegalMoves=[],this._gameState=x.UNDEFINED,this.WIDTH=8,this.HEIGHT=8,this.SIZE=this.WIDTH*this.HEIGHT,this._normie_pieces=[],this._golden_pieces=[],this._golden_squares=[],this.normie_pieces_bitboard=new a(t.getBoard()&~o.getBoard()),this.golden_pieces_bitboard=o,this.golden_squares_bitboard=r,this.updateBitboardToSquares(),this.generateCurrentLegalMoves()}updateBitboardToSquares(){this._normie_pieces=P(this.normie_pieces_bitboard),this._golden_pieces=P(this.golden_pieces_bitboard),this._golden_squares=P(this.golden_squares_bitboard)}checkWin(){return oe(this.golden_pieces_bitboard,this.golden_squares_bitboard).getBoard()===this.golden_squares_bitboard.getBoard()?x.WIN:x.UNDEFINED}get gameState(){return this._gameState}get turn(){return this.moveHistory.length}get moveHistory(){return this._listOfMoves}get undoHistory(){return this._undoList}get currentLegalMoves(){return this._currentLegalMoves}undoMove(){let t=this._listOfMoves.pop();return t?(this.makeMove(G(t.destination,t.origin)),this.generateCurrentLegalMoves(),this._undoList.push(t),F.UNDO_SUCCESS):l.NO_MOVE_TO_UNDO}redoMove(){if(!this._undoList)return l.NO_MOVE_TO_REDO;let t=this._undoList.pop();return t?(this.makeMove(t),this._listOfMoves.push(t),this.generateCurrentLegalMoves(),F.REDO_SUCCESS):l.NO_MOVE_TO_REDO}goToMove(t){if(this.moveHistory.length+this.undoHistory.length===0)return l.NO_MOVE_TO_GO;let o=Math.abs(this.moveHistory.length-t);if(t===this.moveHistory.length)return F.GO_TO_SUCCESS;if(this.moveHistory.length>t)for(let r=0;r<o;r++)this.undoMove();else if(this.moveHistory.length<t){if(this.undoHistory.length<t-this.moveHistory.length)return l.NO_MOVE_TO_GO;for(let r=0;r<o;r++)this.redoMove()}return F.GO_TO_SUCCESS}resetBoard(){this.goToMove(0),this._listOfMoves=[],this._undoList=[]}inputMove(t){if(!this.isValidSquare(t.origin)||!this.isValidSquare(t.destination))return l.NOT_VALID_SQUARE;if(!this.isPieceOnSquare(t.origin))return l.COULD_NOT_FIND_PIECE;if(this.isPieceOnSquare(t.destination))return l.POSITION_OCCUPIED;if(!this._currentLegalMoves.find(i=>ee(i,t)))return l.NOT_LEGAL_MOVE;this.makeMove(t),this._listOfMoves.push(t);let r=this.undoHistory.pop();r&&(ee(t,r)||(this._undoList=[])),this.generateCurrentLegalMoves();let n=this.checkWin();return n===x.WIN?x.WIN:(this._gameState=n,F.MOVE_SUCCESS)}makeMove(t){let o=me(t);(_e(t).getBoard()&this.golden_pieces_bitboard.getBoard())>0?this.golden_pieces_bitboard=J(this.golden_pieces_bitboard,o):this.normie_pieces_bitboard=J(this.normie_pieces_bitboard,o),this.updateBitboardToSquares()}isValidSquare(t){let o=S(t);return o>=0&&o<this.SIZE}isPieceOnSquare(t){let o=S(t);return!!te(this.normie_pieces_bitboard,this.golden_pieces_bitboard).getBit(o)}generateCurrentLegalMoves(){this._currentLegalMoves=[],P(this.occupancy).forEach(o=>{let r=this.generateLegalMovesFromSquare(o);this._currentLegalMoves=[...this._currentLegalMoves,...r]})}generateLegalMovesFromSquare(t){let o=this.attacksBitboard(S(t));return P(o).map(r=>({origin:t,destination:r}))}attacksBitboard(t){let o=a.empty().setBit(t).getBoard(),r=N(o),n=this.occupancy.getBoard(),i=a.rankMask($(t)).getBoard(),s=a.fileMask(W(t)).getBoard(),u=n&i,h=N(u),v=n&s,T=N(v),Z=(u-BigInt(2)*o^N(h-BigInt(2)*r))&i&K((n^o)&i),xe=(v-BigInt(2)*o^N(T-BigInt(2)*r))&s&K((n^o)&s);return new a(Z|xe)}static EMPTY(){return new e(a.empty(),a.empty(),a.empty())}},l=function(e){return e.POSITION_OCCUPIED="There is already another piece in that location!",e.COULD_NOT_FIND_PIECE="No piece could be found in that location.",e.NOT_VALID_SQUARE="Not a valid square.",e.NOT_LEGAL_MOVE="Not a legal move.",e.NO_MOVE_TO_UNDO="No move left to Undo.",e.NO_MOVE_TO_REDO="No move left to Redo.",e.NO_MOVE_TO_GO="No move to go to.",e.WRONG_INPUT="You submitted a wrong input.",e}(l||{}),F=function(e){return e.MOVE_SUCCESS="Successfully moved piece.",e.UNDO_SUCCESS="Successfully undid move.",e.REDO_SUCCESS="Successfully redid move.",e.GO_TO_SUCCESS="Successfully restored turn.",e}(F||{}),x=function(e){return e.WIN="You won the game",e.UNDEFINED="Undefined",e.LOST="You lost",e}(x||{}),D=e=>!!Object.values(l).includes(e);var Se=new ArrayBuffer(256),re=new Uint8Array(Se),j=e=>[e,e+2*64,e+1*64,e+3*64],A=e=>[...j(e),...j(e+2*16),...j(e+1*16),...j(e+3*16)],Y=e=>[...A(e),...A(e+2*4),...A(e+1*4),...A(e+3*4)];re.set([...Y(0),...Y(2),...Y(1),...Y(3)]);var a=class e{constructor(t){let o=BigInt.asUintN(64,t);this.validateBitboard(o),this.board=o}validateBitboard(t){if(t<BigInt(0)||t>BigInt("0xFFFFFFFFFFFFFFFF"))throw new Error("Invalid uint64 bitboard. Must be between 0 and 0xFFFFFFFFFFFFFFFF.")}getBoard(){return this.board}leftShift(t){return new e(this.board<<BigInt(t))}rightShift(t){return new e(this.board>>BigInt(t))}setBit(t){return te(this,e.one().leftShift(t))}clearBit(t){return oe(this,Ce(e.one().leftShift(t)))}getBit(t){let o=this.board>>BigInt(t);return Number(o&BigInt(1))}surroundingBits(){let o=this.getBoard(),r=this.getBoard();for(let n=0;n<8;n++)for(let i=0;i<8;i++){let s=n*8+i;if((r&1n<<BigInt(s))!==0n)for(let u=-1;u<=1;u++)for(let h=-1;h<=1;h++){let v=n+u,T=i+h;if(v>=0&&v<8&&T>=0&&T<8&&!(u!==0&&h!==0)){let Z=v*8+T;o|=1n<<BigInt(Z)}}}return o&=~r,new e(o)}static fromBinaryString(t){let o=BigInt("0b"+t);return new e(o)}static fromBinary(t){let o=BigInt(t);return new e(o)}static empty(){return new e(BigInt(0))}static one(){return new e(BigInt(1))}static fileMask(t){if(t<0||t>7)throw new Error("Invalid file. Must be between 0 and 7.");let o=e.empty();for(let r=0;r<8;r++){let n=r*8+t;o=o.setBit(n)}return o}static rankMask(t){if(t<0||t>7)throw new Error("Invalid rank. Must be between 0 and 7.");let o=e.empty();for(let r=0;r<8;r++){let n=t*8+r;o=o.setBit(n)}return o}asTableString(t="1"){let o=this.board.toString(2).padStart(64,"0"),r="";for(let n=0;n<8;n++){let i="";for(let s=7;s>=0;s--){let u=n*8+s;i+=o[u]==="1"?`${t} `:"0 "}r+=i.trim()+`
`}return r.trim()}logAsArray(){let t=this.board.toString(2).padStart(64,"0"),o=[];for(let r=7;r>=0;r--)o.push(t.slice(r*8,(r+1)*8).split("").reverse().join(" "));return o}static full(){return new e(BigInt("0xFFFFFFFFFFFFFFFF"))}},J=(e,t)=>new a(e.getBoard()^t.getBoard()),te=(e,t)=>new a(e.getBoard()|t.getBoard()),oe=(e,t)=>new a(e.getBoard()&t.getBoard()),Ce=e=>new a(~e.getBoard()),$=e=>Math.floor(e/8),W=e=>e%8;var P=e=>{let t=[];for(let o=0;o<64;o++)e.getBit(o)===1&&t.push(L(o));return t};var me=e=>a.empty().setBit(S(e.origin)).setBit(S(e.destination)),_e=e=>a.empty().setBit(S(e.origin));var N=e=>{let t=Be(e),o=we(t);return Me(o)},Be=e=>{let t=new Uint8Array(8);for(let o=0;o<8;o++)t[o]=Number(e>>BigInt(8*o)&BigInt(255));return t},Me=e=>{let t=BigInt.asUintN(64,0n);for(let o=0;o<8;o++)t=t<<BigInt(8)^BigInt(e[o]);return t},we=e=>e.map(o=>re[o]),K=e=>{let o=e;for(let r=0;r<8;r++)for(let n=0;n<8;n++){let i=r*8+n;if((e&1n<<BigInt(i))!==0n)for(let s=-1;s<=1;s++)for(let u=-1;u<=1;u++){let h=r+s,v=n+u;if(h>=0&&h<8&&v>=0&&v<8&&!(s!==0&&u!==0)){let T=h*8+v;o|=1n<<BigInt(T)}}}return o&=~e,o},Ee=e=>{let t=a.empty();return e.forEach(o=>{let r=S(ge(o));t=t.setBit(r)}),t},Te=e=>{if(e.length%2!==0)return l.WRONG_INPUT;let t=e.match(/.{1,2}/g);return t||l.WRONG_INPUT},Q=e=>{let t=Te(e);if(D(t))return a.empty();let o=Ee(t);return D(o)?a.empty():o};var ne=["A","B","C","D","E","F","G","H"];var S=e=>e.rank*8+e.file,L=e=>H($(e),W(e)),H=(e,t)=>({rank:e,file:t}),ie=(e,t)=>e.file===t.file&&e.rank===t.rank,X=e=>`${ne[e.file]}${e.rank+1}`,ge=e=>H(Number(e[1])-1,ne.findIndex(t=>t===e[0]));var G=(e,t)=>({origin:e,destination:t}),ee=(e,t)=>ie(e.origin,t.origin)&&ie(e.destination,t.destination),E=e=>`${X(e.origin)} => ${X(e.destination)}`;var Oe=e=>({highlighted:e});function Ie(e,t){if(e&1){let o=C();p(0,"button",3),m("click",function(){let i=_(o).$index,s=c();return g(s.sendGoTo(i+1))}),q(1),d()}if(e&2){let o=t.$implicit,r=t.$index,n=c();b("ngClass",R(3,Oe,r+1===n.board.moveHistory.length)),f(1),ue(" ",r+1," ",n.MoveToString(o)," ")}}var fe=(()=>{let t=class t{constructor(){this.goToEvent=new y,this.undoEvent=new y,this.resetEvent=new y,this.redoEvent=new y}get allMovesHistory(){return[...this.board.moveHistory,...[...this.board.undoHistory].reverse()]}sendGoTo(r){this.goToEvent.emit(r)}sendUndo(){this.undoEvent.emit()}sendRedo(){this.redoEvent.emit()}sendReset(){this.resetEvent.emit()}MoveToString(r){return E(r)}};t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=B({type:t,selectors:[["board-info"]],inputs:{board:"board"},outputs:{goToEvent:"goToEvent",undoEvent:"undoEvent",resetEvent:"resetEvent",redoEvent:"redoEvent"},standalone:!0,features:[M],decls:13,vars:0,consts:[[1,"moves"],[1,"actions"],[3,"click"],[3,"ngClass","click"],[3,"ngClass"]],template:function(n,i){n&1&&(p(0,"main")(1,"h1"),q(2,"Board Info"),d(),p(3,"section",0),I(4,Ie,2,5,"button",4,O),d(),p(6,"section",1)(7,"button",2),m("click",function(){return i.sendUndo()}),q(8,"UNDO"),d(),p(9,"button",2),m("click",function(){return i.sendRedo()}),q(10,"REDO"),d(),p(11,"button",2),m("click",function(){return i.sendReset()}),q(12,"RESET"),d()()()),n&2&&(f(4),k(i.allMovesHistory))},dependencies:[w,z],styles:["main[_ngcontent-%COMP%]{width:200px;height:100%;display:flex;flex-direction:column;justify-content:space-between;align-items:center;background-color:#624f82}.moves[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:90%;height:250px;background-color:#9f73ab;border-radius:5px;overflow-y:auto}.highlighted[_ngcontent-%COMP%]{background-color:#a3c7d6}"]});let e=t;return e})();function ke(e,t){if(e&1){let o=C();p(0,"div",1),m("click",function(){let i=_(o).$implicit,s=c();return g(s.setSelectedSquare(i.file,i.rank))}),d()}if(e&2){let o=t.$implicit,r=c();V("grid-column",o.file+1)("grid-row",r.board.HEIGHT-o.rank+1)}}function Fe(e,t){if(e&1){let o=C();p(0,"div",1),m("click",function(){let i=_(o).$implicit,s=c();return g(s.setSelectedSquare(i.file,i.rank))}),d()}if(e&2){let o=t.$implicit,r=c();V("background-color","yellow")("grid-column",o.file+1)("grid-row",r.board.HEIGHT-o.rank+1)}}var he=e=>({highlighted:e});function qe(e,t){if(e&1){let o=C();p(0,"div",2),m("click",function(){let i=_(o).$implicit,s=c();return g(s.setSelectedPiece(i.file,i.rank))}),d()}if(e&2){let o=t.$implicit,r=c();V("grid-column",o.file+1)("grid-row",r.board.HEIGHT-o.rank+1),b("ngClass",R(5,he,o.file===(r.selectedPieceSquare==null?null:r.selectedPieceSquare.file)&&o.rank===(r.selectedPieceSquare==null?null:r.selectedPieceSquare.rank)))}}function Pe(e,t){if(e&1){let o=C();p(0,"div",2),m("click",function(){let i=_(o).$implicit,s=c();return g(s.setSelectedPiece(i.file,i.rank))}),d()}if(e&2){let o=t.$implicit,r=c();V("background-color","blue")("grid-column",o.file+1)("grid-row",r.board.HEIGHT-o.rank+1),b("ngClass",R(7,he,o.file===(r.selectedPieceSquare==null?null:r.selectedPieceSquare.file)&&o.rank===(r.selectedPieceSquare==null?null:r.selectedPieceSquare.rank)))}}var ve=(()=>{let t=class t{constructor(){this.moveEvent=new y,this.squares=Array(64).fill(0).map((r,n)=>L(n)),this.selectedPieceSquare=null,this.selectedSquare=null}setSelectedPiece(r,n){this.selectedPieceSquare=H(n,r)}setSelectedSquare(r,n){if(!this.selectedPieceSquare)return;this.selectedSquare=H(n,r);let i=G(this.selectedPieceSquare,this.selectedSquare);this.sendMove(i),this.selectedPieceSquare=null,this.selectedSquare=null}sendMove(r){this.moveEvent.emit(r)}};t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=B({type:t,selectors:[["board-canvas"]],inputs:{board:"board"},outputs:{moveEvent:"moveEvent"},standalone:!0,features:[M],decls:9,vars:0,consts:[[1,"wrapper"],[1,"square",3,"click"],[1,"piece",3,"ngClass","click"],["class","square",3,"gridColumn","gridRow"],["class","square",3,"backgroundColor","gridColumn","gridRow"],["class","piece",3,"ngClass","gridColumn","gridRow"],["class","piece",3,"ngClass","backgroundColor","gridColumn","gridRow"]],template:function(n,i){n&1&&(p(0,"div",0),I(1,ke,1,4,"div",3,O),I(3,Fe,1,6,"div",4,O),I(5,qe,1,7,"div",5,O),I(7,Pe,1,9,"div",6,O),d()),n&2&&(f(1),k(i.squares),f(2),k(i.board.golden_squares),f(2),k(i.board.normie_pieces),f(2),k(i.board.golden_pieces))},dependencies:[w,z],styles:[".wrapper[_ngcontent-%COMP%]{aspect-ratio:1;display:grid;width:min(412px,50vw);grid-template-columns:repeat(8,1fr);grid-template-rows:repeat(8,1fr);background-color:#4b7399;border:black solid 1px;justify-items:center;align-items:center}.piece[_ngcontent-%COMP%]{transition:background-color .5s;width:100%;border-radius:100%;aspect-ratio:1;display:block;background-color:#4b7399}.square[_ngcontent-%COMP%]{width:100%;border:black solid 1px;transition:all .5s;aspect-ratio:1;display:block;background-color:#eae9d2}.piece[_ngcontent-%COMP%]:hover{background-color:red}.highlighted[_ngcontent-%COMP%]{scale:1.5}"]});let e=t;return e})();function Ne(e,t){if(e&1){let o=C();p(0,"board-info",2),m("undoEvent",function(){_(o);let n=c();return g(n.undoMove())})("resetEvent",function(){_(o);let n=c();return g(n.resetBoard())})("redoEvent",function(){_(o);let n=c();return g(n.redoMove())})("goToEvent",function(n){_(o);let i=c();return g(i.goToMove(n))}),d()}if(e&2){let o=c();b("board",o.board)}}var be=(()=>{let t=class t{inputRandomMove(){let r=this.board.currentLegalMoves,n=He(r);if(!n){this.resetBoard();return}this.board.inputMove(n)===x.WIN&&console.log("YOU WONN")}inputMove(r){let n=this.board.inputMove(r);if(Object.values(l).includes(n)){console.error(n);return}console.log(this.board.moveHistory.length,E(r)),n===x.WIN&&console.log(n)}undoMove(){this.board.undoMove()}goToMove(r){let n=this.board.goToMove(r);if(D(n)){console.error(n);return}let i=this.board.moveHistory[this.board.moveHistory.length-1];if(!i)return;let s=E(i);console.log(this.board.moveHistory.length,s)}redoMove(){this.board.redoMove()}resetBoard(){this.board.resetBoard()}logMoves(){let r=this.board.moveHistory.map(i=>E(i)),n=this.board.undoHistory.map(i=>E(i));console.log(r),console.log(n)}};t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=B({type:t,selectors:[["board"]],inputs:{board:"board",showInfo:"showInfo"},standalone:!0,features:[M],decls:3,vars:2,consts:[[3,"board","moveEvent"],[3,"board"],[3,"board","undoEvent","resetEvent","redoEvent","goToEvent"]],template:function(n,i){n&1&&(p(0,"main")(1,"board-canvas",0),m("moveEvent",function(u){return i.inputMove(u)}),d(),ce(2,Ne,1,1,"board-info",1),d()),n&2&&(f(1),b("board",i.board),f(1),de(2,i.showInfo?2:-1))},dependencies:[w,ve,fe],styles:["[_nghost-%COMP%]{display:flex;justify-content:center;align-items:center;flex-direction:column}main[_ngcontent-%COMP%]{display:flex;flex-direction:row}.actions[_ngcontent-%COMP%]{width:100vw;display:flex;justify-content:center;align-items:center}"]});let e=t;return e})();function He(e){if(e.length===0)return;let t=Math.floor(Math.random()*e.length);return e[t]}var zt=(()=>{let t=class t{constructor(){this.activatedRoute=ae(pe),this.normie_pieces_bitboard=Q(this.activatedRoute.snapshot.params.normie_pieces),this.golden_piece_bitboard=Q(this.activatedRoute.snapshot.params.golden_piece),this.golden_square_bitboard=Q(this.activatedRoute.snapshot.params.golden_square),this.board=new U(this.normie_pieces_bitboard,this.golden_piece_bitboard,this.golden_square_bitboard)}};t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=B({type:t,selectors:[["puzzle-repo-level-n"]],standalone:!0,features:[M],decls:1,vars:2,consts:[[3,"board","showInfo"]],template:function(n,i){n&1&&le(0,"board",0),n&2&&b("board",i.board)("showInfo",!0)},dependencies:[w,be]});let e=t;return e})();export{zt as LevelNComponent};
